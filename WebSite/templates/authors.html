<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Авторы - Digital Gallery</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        .works-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
        }
        /* Контейнер чекбокса */
            .checkbox-container {
              display: flex;
              align-items: left;
              margin-bottom: 3px;
              cursor: default;
            }

            /* Сам чекбокс */
            .checkbox-container input[type="checkbox"] {
              appearance: none;
              -webkit-appearance: none;
              -moz-appearance: none;
              width: 25px;
              height: 25px;
              border: 2px solid #2e2e2e;
              border-radius: 4px;
              margin-right: 10px;
              position: relative;
              outline: none;
              cursor: pointer;
              transition: background-color 0.2s, border-color 0.2s;
            }

            /* Стили при активации чекбокса */
            .checkbox-container input[type="checkbox"]:checked {
              background: linear-gradient(135deg, #bbb, #999999);
            }

            /* Текст рядом с чекбоксом */
            .checkbox-container label {
              cursor: pointer;
              color: #cccccc;
              font-size: 1rem;
            }
            .no-redirect {
                cursor: default;
            }
    </style>
</head>
<body>
<!-- Меню -->
{% include 'header.html' %}

<!-- Форма фильтрации авторов -->
<form id="filterForm" method="get" action="{{ url_for('authors') }}">
    <section class="reveal" id="authorFilterSection">
        <h2>Фильтрация авторов</h2>
        <div class="filter-group">
            <label for="authorNameFilter">По имени автора:</label>
            <input list="authors_name" id="authorNameFilter" name="authors_name"
                   value="{{ authors_name if authors_name else '' }}">
            <datalist id="authors_name">
                {% for a in authors_name_list %}
                <option value="{{ a }}">
                    {% endfor %}
            </datalist>

            <div class="checkbox-container">
                <input type="checkbox" id="popularFilter" name="popularFilter" value="on"
                       {% if popularFilter %}checked{% endif %}>
                <label for="popularFilter">По популярности</label>
            </div>

            <div class="checkbox-container">
                <input type="checkbox" id="worksCountFilter" name="worksCountFilter" value="on"
                       {% if worksCountFilter %}checked{% endif %}>
                <label for="worksCountFilter">По количеству работ</label>
            </div>
        </div>
    </section>
</form>

<!-- Секция авторов -->
<section class="reveal" id="authorsSection">
    <h2>Список авторов</h2>
    <div class="works-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); align-items: start;">
        {% for item in authors %}
        <div class="author-card" data-link="{{ url_for('profile', id=item.user.id) }}">
            <div class="image-container">
                <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ffullhdoboi.ru%2Fwp-content%2Fuploads%2F_ph%2F6%2F587063014.jpg&f=1&nofb=1&ipt=c96c1def3259a88acc54accdae63806f88b8e9f2ba25a93e7b979f9c14fa0ab5"
                     alt="Автор" class="author-image">
            </div>
            <h3 class="no-redirect">{{item.user.nick_name}}</h3>
            <p class="no-redirect">Работ: {{item.works_count}} | Просмотров: {{item.total_views}}</p>
            <div class="popular-works">
                {% for work in item.popular_works %}
                <div class="work-item no-redirect">
                    {{work.name}} – {{work.views}} просмотров
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<script>
    window.addEventListener("load", () => {
      const reveals = document.querySelectorAll(".reveal");
      reveals.forEach(el => el.classList.add("active"));
    });

    const form = document.getElementById("filterForm");

    // Реагирование на чекбокс
    const checkboxIds = ["popularFilter", "worksCountFilter"];
    checkboxIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener("change", () => {
                form.submit();
            });
        }
    });

    // Реагирование на нажатие Enter
    const authorInput = document.getElementById("authorNameFilter");
        if (authorInput) {
            authorInput.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    e.preventDefault();
                    form.submit();
                }
            });
        }

    document.querySelectorAll('.author-card').forEach(card => {
        card.addEventListener('click', function (e) {
            // Если кликнули по элементу с классом .no-redirect — не переходим
            if (!e.target.closest('.no-redirect')) {
                const url = card.getAttribute('data-link');
                if (url) {
                    window.location.href = url;
                }
            }
        });
    });
</script>
</body>
</html>